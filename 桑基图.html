<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é€ èˆ¹ä¸šä¸Šä¸‹æ¸¸äº§ä¸šå…³è”æ¼”è¿›åˆ†æ</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
    body {
      background-color: var(--bg-color); color: var(--text-color);
      transition: background-color 0.3s, color 0.3s; padding: 20px; min-height: 100vh;
    }
    :root {
      --bg-color: #f4f7fa; --text-color: #333;
      --card-bg: #ffffff; --primary-color: #1e90ff;
      --accent-color: #ff6b6b; --shipbuilding-color: #4bc0c0;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    body.dark {
      --bg-color: #1a1a1a; --text-color: #e0e0e0; --card-bg: #2c2c2c;
    }
    .container { max-width: 1400px; margin: 0 auto; text-align: center; }
    h1 { font-size: 2.2rem; margin-bottom: 10px; color: var(--primary-color); }
    p { font-size: 1.1rem; color: var(--text-color); margin-bottom: 20px; }
    .year-buttons {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 30px;
    }
    .year-button {
      padding: 10px 20px; font-size: 1rem; border: none; border-radius: 20px;
      background-color: var(--primary-color); color: #fff; cursor: pointer;
      transition: transform 0.2s, background-color 0.2s;
    }
    .year-button:hover { transform: scale(1.05); background-color: #1c86ee; }
    .year-button.active { background-color: var(--accent-color); }
    .content { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
    .card {
      background-color: var(--card-bg); border-radius: 10px; padding: 20px;
      box-shadow: var(--shadow);
    }
    #sankeyChart { height: 600px; }
    .pie-charts { display: flex; flex-direction: column; gap: 20px; }
    .chart-container h3 {
      font-size: 1.2rem; margin-bottom: 10px; color: var(--text-color);
    }
    #upstreamChart, #downstreamChart { height: 300px; }
    .theme-toggle {
      position: fixed; top: 20px; right: 20px; padding: 10px;
      background-color: var(--primary-color); color: #fff;
      border: none; border-radius: 50%; cursor: pointer;
    }
    .summary { margin-bottom: 20px; font-size: 1rem; color: var(--text-color); }
    @media (max-width: 768px) {
      .content { grid-template-columns: 1fr; }
      h1 { font-size: 1.8rem; }
      p { font-size: 1rem; }
      .year-button { padding: 8px 16px; font-size: 0.9rem; }
      #sankeyChart { height: 400px; }
      #upstreamChart, #downstreamChart { height: 250px; }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
  <div class="container">
    <h1>é€ èˆ¹ä¸šä¸Šä¸‹æ¸¸äº§ä¸šå…³è”æ¼”è¿›åˆ†æ</h1>
    <p>åŠ¨æ€å±•ç¤º2002-2020å¹´é—´é€ èˆ¹ä¸šä¸ä¸Šä¸‹æ¸¸äº§ä¸šçš„ä»·å€¼æµåŠ¨ä¸ç»“æ„å˜åŒ–ï¼Œæ­ç¤ºäº§ä¸šå…³è”æ¼”å˜è¶‹åŠ¿</p>
    <div class="year-buttons" id="yearButtons"></div>
    <div class="summary" id="summary">åŠ è½½æ•°æ®ä¸­...</div>
    <div class="content">
      <div class="card"><div id="sankeyChart"></div></div>
      <div class="pie-charts">
        <div class="card chart-container">
          <h3>ä¸Šæ¸¸äº§ä¸šå æ¯”</h3>
          <div id="upstreamChart"></div>
        </div>
        <div class="card chart-container">
          <h3>ä¸‹æ¸¸äº§ä¸šå æ¯”</h3>
          <div id="downstreamChart"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const years = [2002, 2007, 2012, 2017, 2018, 2020];
    let currentYear = 2002;

    const csvDataMap = {
  2002: `Source,Target,Value
èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,æ°´ä¸Šè¿è¾“ä¸š,2510797
èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,å‡ºå£,1524556
èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,æ¸”ä¸š,741100
è£…å¤‡åˆ¶é€ ä¸æœºæ¢°è®¾å¤‡,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,1239947
åŸºç¡€åŸææ–™ä¸èƒ½æºå·¥ä¸š,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,1074778
ç”µæ°”ç”µå­ä¸ä»ªå™¨åˆ¶é€ ,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,493156
æœåŠ¡ä¸šä¸å…¶ä»–,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,357267
åŒ–å·¥ä¸ææ–™åŠ å·¥,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,290118`,

  2007: `Source,Target,Value
èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,å‡ºå£,8792300
èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,æ°´ä¸Šè¿è¾“ä¸š,4529141
èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,æ¸”ä¸š,1087882
åŸºç¡€åŸææ–™ä¸èƒ½æºå·¥ä¸š,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,4857624
ç”µæ°”ç”µå­ä¸ä»ªå™¨åˆ¶é€ ,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,3941530
è£…å¤‡åˆ¶é€ ä¸æœºæ¢°è®¾å¤‡,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,3708523
æœåŠ¡ä¸šä¸å…¶ä»–,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,1523069
åŒ–å·¥ä¸ææ–™åŠ å·¥,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,1016752
æ±½è½¦ä¸äº¤é€šç›¸å…³,èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š,368061`,

  2012: `Source,Target,Value
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,å‡ºå£,22528696
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ°´ä¸Šè¿è¾“ä¸š,3575955
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ¸”äº§å“,510776
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,é‡‘å±åˆ¶å“ã€æœºæ¢°å’Œè®¾å¤‡ä¿®ç†æœåŠ¡,324001
ç”µæ°”ç”µå­ä¸ä»ªå™¨åˆ¶é€ ,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,9218674
åŸºç¡€åŸææ–™ä¸èƒ½æºå·¥ä¸š,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,9218299
è£…å¤‡åˆ¶é€ ä¸æœºæ¢°è®¾å¤‡,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,7254729
æœåŠ¡ä¸šä¸å…¶ä»–,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,5861248
åŒ–å·¥ä¸ææ–™åŠ å·¥,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,3294965
æ±½è½¦ä¸äº¤é€šç›¸å…³,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,536378`,

  2017: `Source,Target,Value
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,å‡ºå£,13963566
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ°´ä¸Šè´§ç‰©è¿è¾“å’Œè¿è¾“è¾…åŠ©æ´»åŠ¨,3653904
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,é‡‡çŸ¿ã€å†¶é‡‘ã€å»ºç­‘ä¸“ç”¨è®¾å¤‡,1606811
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ¸”äº§å“,621885
ç”µæ°”ç”µå­ä¸ä»ªå™¨åˆ¶é€ ,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,8831031
è£…å¤‡åˆ¶é€ ä¸æœºæ¢°è®¾å¤‡,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,6838124
æœåŠ¡ä¸šä¸å…¶ä»–,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,5777425
åŸºç¡€åŸææ–™ä¸èƒ½æºå·¥ä¸š,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,5516883
åŒ–å·¥ä¸ææ–™åŠ å·¥,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,3324993
æ±½è½¦ä¸äº¤é€šç›¸å…³,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,710457`,

  2018: `Source,Target,Value
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,å‡ºå£,14552143
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ°´ä¸Šè´§ç‰©è¿è¾“å’Œè¿è¾“è¾…åŠ©æ´»åŠ¨,3715765
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,é‡‡çŸ¿ã€å†¶é‡‘ã€å»ºç­‘ä¸“ç”¨è®¾å¤‡,1352721
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ¸”äº§å“,636883
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,é‡‘å±åˆ¶å“ã€æœºæ¢°å’Œè®¾å¤‡ä¿®ç†æœåŠ¡,543791
ç”µæ°”ç”µå­ä¸ä»ªå™¨åˆ¶é€ ,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,7195748
è£…å¤‡åˆ¶é€ ä¸æœºæ¢°è®¾å¤‡,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,5244073
åŸºç¡€åŸææ–™ä¸èƒ½æºå·¥ä¸š,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,4782151
æœåŠ¡ä¸šä¸å…¶ä»–,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,4646925
åŒ–å·¥ä¸ææ–™åŠ å·¥,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,2624869
æ±½è½¦ä¸äº¤é€šç›¸å…³,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,432431`,

  2020: `Source,Target,Value
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,å‡ºå£,13194614
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ°´ä¸Šè´§ç‰©è¿è¾“å’Œè¿è¾“è¾…åŠ©æ´»åŠ¨,4550661
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,é‡‡çŸ¿ã€å†¶é‡‘ã€å»ºç­‘ä¸“ç”¨è®¾å¤‡,1440980
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,æ¸”äº§å“,653482
èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,é‡‘å±åˆ¶å“ã€æœºæ¢°å’Œè®¾å¤‡ä¿®ç†æœåŠ¡,536243
ç”µæ°”ç”µå­ä¸ä»ªå™¨åˆ¶é€ ,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,5649781
è£…å¤‡åˆ¶é€ ä¸æœºæ¢°è®¾å¤‡,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,4300444
æœåŠ¡ä¸šä¸å…¶ä»–,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,3981834
åŸºç¡€åŸææ–™ä¸èƒ½æºå·¥ä¸š,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,3751893
åŒ–å·¥ä¸ææ–™åŠ å·¥,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,1952450
æ±½è½¦ä¸äº¤é€šç›¸å…³,èˆ¹èˆ¶åŠç›¸å…³è£…ç½®,252885`
};

const nodeColors = {
  'èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š': '#4bc0c0',
  'èˆ¹èˆ¶åŠç›¸å…³è£…ç½®': '#4bc0c0',
  'å‡ºå£': '#ff6b6b',
  'æ°´ä¸Šè¿è¾“ä¸š': '#ff6b6b',
  'æ°´ä¸Šè´§ç‰©è¿è¾“å’Œè¿è¾“è¾…åŠ©æ´»åŠ¨': '#ff6b6b',
  'æ¸”ä¸š': '#ff6b6b',
  'æ¸”äº§å“': '#ff6b6b',
  'é‡‡çŸ¿ã€å†¶é‡‘ã€å»ºç­‘ä¸“ç”¨è®¾å¤‡': '#ff6b6b',
  'é‡‘å±åˆ¶å“ã€æœºæ¢°å’Œè®¾å¤‡ä¿®ç†æœåŠ¡': '#ff6b6b',
  'è£…å¤‡åˆ¶é€ ä¸æœºæ¢°è®¾å¤‡': '#1e90ff',
  'åŸºç¡€åŸææ–™ä¸èƒ½æºå·¥ä¸š': '#1e90ff',
  'ç”µæ°”ç”µå­ä¸ä»ªå™¨åˆ¶é€ ': '#1e90ff',
  'æœåŠ¡ä¸šä¸å…¶ä»–': '#1e90ff',
  'åŒ–å·¥ä¸ææ–™åŠ å·¥': '#1e90ff',
  'æ±½è½¦ä¸äº¤é€šç›¸å…³': '#1e90ff'
};

    const sankeyChart = echarts.init(document.getElementById('sankeyChart'));
    const upstreamChart = echarts.init(document.getElementById('upstreamChart'));
    const downstreamChart = echarts.init(document.getElementById('downstreamChart'));

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    const yearButtons = document.getElementById('yearButtons');
    years.forEach(year => {
      const btn = document.createElement('button');
      btn.className = 'year-button';
      btn.textContent = year;
      btn.onclick = () => selectYear(year);
      yearButtons.appendChild(btn);
    });

    function processData(csv, year) {
      const parsed = Papa.parse(csv.trim(), { header: true }).data;
      const links = parsed
        .map(r => ({ source: r.Source, target: r.Target, value: +r.Value }))
        .filter(link => link.source !== link.target);  // âœ… å…³é”®ä¿®å¤ï¼šå»é™¤è‡ªç¯

      const nodes = [...new Set(links.flatMap(l => [l.source, l.target]))].map(name => ({ name }));

      const centerNode = nodes.find(n => n.name.includes('èˆ¹èˆ¶'))?.name || 'èˆ¹èˆ¶åŠæµ®åŠ¨è£…ç½®åˆ¶é€ ä¸š';

      const upstream = {}, downstream = {};
      let totalUp = 0, totalDown = 0;
      links.forEach(({ source, target, value }) => {
        if (target === centerNode) { upstream[source] = (upstream[source] || 0) + value; totalUp += value; }
        if (source === centerNode) { downstream[target] = (downstream[target] || 0) + value; totalDown += value; }
      });

      const upstreamData = Object.entries(upstream).map(([name, value]) => ({ name, value }));
      const downstreamData = Object.entries(downstream).map(([name, value]) => ({ name, value }));
      const summary = `åœ¨${year}å¹´ï¼Œä¸Šæ¸¸äº§ä¸šä¸­${upstreamData[0]?.name || 'æœªçŸ¥'}å æ¯”æœ€é«˜ï¼Œä¸‹æ¸¸äº§ä¸šä¸­${downstreamData[0]?.name || 'æœªçŸ¥'}å æ¯”æœ€é«˜ã€‚`;
      return { nodes, links, upstreamData, downstreamData, summary };
    }

    function updateCharts(year) {
      const csv = csvDataMap[year];
      const { nodes, links, upstreamData, downstreamData, summary } = processData(csv, year);

      sankeyChart.setOption({
        tooltip: { trigger: 'item' },
        series: [{
          type: 'sankey',
          layout: 'none',
          data: nodes.map(n => ({ ...n, itemStyle: { color: nodeColors[n.name] || '#ccc' } })),
          links,
          lineStyle: { color: 'gradient', curveness: 0.5 }
        }]
      });

      const roseOption = (title, data) => ({
        tooltip: { trigger: 'item' },
        series: [{
          name: title,
          type: 'pie',
          roseType: 'area',
          radius: [30, 100],
          center: ['50%', '50%'],
          data,
          label: { formatter: '{b}: {d}%' }
        }]
      });

      upstreamChart.setOption(roseOption('ä¸Šæ¸¸äº§ä¸š', upstreamData));
      downstreamChart.setOption(roseOption('ä¸‹æ¸¸äº§ä¸š', downstreamData));
      document.getElementById('summary').textContent = summary;

      document.querySelectorAll('.year-button').forEach(btn =>
        btn.classList.toggle('active', +btn.textContent === year)
      );
    }

    function selectYear(year) {
      currentYear = year;
      updateCharts(year);
    }

    updateCharts(currentYear);
  </script>
</body>
</html>

